<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Queen of Hearts Casino</title>
    <link rel="stylesheet" href="style.css">
</head>
<body class="dashboard-body">

    <nav class="navbar">
        <div class="logo">Queen of Hearts Casino</div>
        
        <div class="user-controls">
            <div class="nav-info-box">
                Account balance : $<span id="credits-display">...</span>
            </div>
            
            <div class="nav-info-box" id="username-display" onclick="window.location.href='/account'" style="cursor: pointer;">
                Guest
            </div>
            
            <button class="logout-btn" onclick="logout()">Logout</button>
        </div>
    </nav>

    <div class="game-container">
        <div class="game-card" onclick="window.location.href='/buy-credits'">
            <h2>Add credits!</h2>
            <p>Top up your balance</p>
        </div>

        <div class="game-card" onclick="window.location.href='/poker'">
            <h2>Play Poker!</h2>
            <p>Win with your hand</p>
        </div>

        <div class="game-card" onclick="window.location.href='/blackjack'">
            <h2>Play Blackjack!</h2>
            <p>Beat the dealer</p>
        </div>
    </div>

    <footer class="footer">Developed by T4B5</footer>

    <script>
        const username = localStorage.getItem('username');

        // 1. Set Username Immediately
        if (username) {
            document.getElementById('username-display').innerText = username;
        }

        // 2. FETCH REAL BALANCE FROM SERVER
        async function fetchUserBalance() {
            if (!username) return;

            try {
                const response = await fetch('/my-stats', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    document.getElementById('credits-display').innerText = data.credits;
                    localStorage.setItem('credits', data.credits);
                }
            } catch (err) {
                console.error("Failed to fetch balance", err);
                document.getElementById('credits-display').innerText = localStorage.getItem('credits') || 0;
            }
        }

        function logout() {
            localStorage.clear(); 
            window.location.href = '/login'; 
        }

        fetchUserBalance();
        window.onpageshow = function(event) {
            if (event.persisted) fetchUserBalance();
        };
    </script>
</body>
</html>